---

- hosts: all
  gather_facts: no

  tasks:
    - name: create env file
      template:
        src: templates/env.j2
        dest: /.env

    - community.docker.docker_container:
        name: redmine-example-app
        image: redmine:5.0.2
        env_file: /.env
        restart_policy: always
        ports:
          - 80:3000
    
- name: Monitoring
  hosts: webservers
  roles:
    - { role: datadog.datadog, become: yes }
  vars:
    datadog_api_key: "{{ DATADOG_API_KEY }}"
    datadog_site: "datadoghq.eu"
    datadog_checks:
      http_check:
        init_config:
        instances:
          - name: Application health check status
            method: GET

